{% extends "dashboard_base.html" %}

{% block dashboard_title %}Today's Check-outs{% endblock %}
{% block dashboard_heading %}Today's Check-outs: {{ today.strftime('%Y-%m-%d') }}{% endblock %}

{% block dashboard_navigation %}
<div class="row mb-4">
    <div class="col-md-3 mb-3">
        <a href="{{ url_for('receptionist.dashboard') }}" class="text-decoration-none">
            <div class="card bg-secondary text-white h-100">
                <div class="card-body text-center">
                    <i class="bi bi-speedometer2 display-4"></i>
                    <h5 class="mt-2">Dashboard</h5>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3 mb-3">
        <a href="{{ url_for('receptionist.bookings') }}" class="text-decoration-none">
            <div class="card bg-success text-white h-100">
                <div class="card-body text-center">
                    <i class="bi bi-calendar-check display-4"></i>
                    <h5 class="mt-2">Bookings</h5>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3 mb-3">
        <a href="{{ url_for('receptionist.guest_list') }}" class="text-decoration-none">
            <div class="card bg-info text-white h-100">
                <div class="card-body text-center">
                    <i class="bi bi-people display-4"></i>
                    <h5 class="mt-2">Guests</h5>
                </div>
            </div>
        </a>
    </div>
    <div class="col-md-3 mb-3">
        <a href="{{ url_for('receptionist.check_out') }}" class="text-decoration-none">
            <div class="card bg-danger text-white h-100"> {# Changed color for check-out #}
                <div class="card-body text-center">
                    <i class="bi bi-box-arrow-out-right display-4"></i> {# Changed icon for check-out #}
                    <h5 class="mt-2">Check-out</h5>
                </div>
            </div>
        </a>
    </div>
</div>
{% endblock %}

{% block dashboard_content %}
<div class="card">
    <div class="card-header bg-danger text-white d-flex justify-content-between align-items-center"> {# Changed color for check-out #}
        <h5 class="mb-0">Today's Check-outs</h5>
        <span class="badge bg-light text-dark">{{ bookings|length }} Departures</span> {# Changed text #}
    </div>
    <div class="card-body">
        {% if bookings %}
        <div class="table-responsive">
            <table class="table table-striped table-bordered">
                <thead class="table-dark">
                    <tr>
                        <th>Booking ID</th>
                        <th>Guest</th>
                        <th>Room</th>
                        <th>Stay Period</th>
                        <th>Status</th>
                        <th>Balance Due</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for booking in bookings %}
                    {# Highlight VIP guests or those with outstanding balance #}
                    <tr class="{% if booking.balance_due > 0 %}table-danger{% elif hasattr(booking.customer, 'loyalty_tier') and booking.customer.loyalty_tier in ['Gold', 'Platinum'] %}table-warning{% endif %}">
                        <td>{{ booking.id }}</td>
                        <td>
                            {{ booking.customer.name }}
                            {% if hasattr(booking.customer, 'loyalty_tier') and booking.customer.loyalty_tier in ['Gold', 'Platinum'] %}
                            <span class="badge bg-warning text-dark">VIP</span>
                            {% endif %}
                            <br>
                            <small class="text-muted">{{ booking.customer.phone or 'No phone' }}</small>
                        </td>
                        <td>
                            {{ booking.room.number }}
                            <br>
                            <small class="text-muted">{{ booking.room.room_type.name }}</small>
                        </td>
                        <td>
                            {{ booking.check_in_date.strftime('%Y-%m-%d') }} to {{ booking.check_out_date.strftime('%Y-%m-%d') }}
                            <br>
                            <small class="text-muted">{{ booking.nights }} night(s)</small>
                        </td>
                        <td>
                            <span class="badge bg-info">{{ booking.status }}</span>
                            <br>
                            <small class="text-muted">{{ booking.payment_status }}</small>
                        </td>
                        <td>
                            {% if booking.balance_due > 0 %}
                                <span class="text-danger fw-bold">{{ booking.balance_due | round(2) }} {{ config.DEFAULT_CURRENCY }}</span>
                            {% else %}
                                <span class="text-success">Paid</span>
                            {% endif %}
                        </td>
                        <td>
                            <div class="btn-group">
                                <a href="{{ url_for('receptionist.check_out_guest', booking_id=booking.id) }}" class="btn btn-sm btn-danger">Check Out</a> {# Changed color and text #}
                                <button type="button" class="btn btn-sm btn-danger dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false"> {# Changed color #}
                                    <span class="visually-hidden">Toggle Dropdown</span>
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="{{ url_for('receptionist.view_folio', booking_id=booking.id) }}">View Folio</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('receptionist.view_booking', booking_id=booking.id) }}">View Booking</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('receptionist.view_guest', customer_id=booking.customer_id) }}">View Guest</a></li>
                                </ul>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-info">
            <h5 class="alert-heading">No Check-outs Today</h5>
            <p>There are no guests scheduled to check out today.</p>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %} 