{% extends "base.html" %}

{% block title %}Room Pricing Management{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">Room Pricing Management</h1>
    
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('manager.dashboard') }}">Dashboard</a></li>
            <li class="breadcrumb-item active" aria-current="page">Room Pricing</li>
        </ol>
    </nav>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div class="card mb-4">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h3 class="h5 mb-0">Room Rates</h3>
            <button type="button" class="btn btn-light btn-sm" data-bs-toggle="modal" data-bs-target="#pricingInfoModal">
                <i class="fas fa-info-circle me-2"></i> Pricing Guide
            </button>
        </div>
        <div class="card-body">
            <form id="pricingForm" method="POST" action="{{ url_for('manager.pricing') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
                {% if room_types_data %}
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead class="table-dark">
                            <tr>
                                <th>Room Type</th>
                                <th>Base Rate ($)</th>
                                <th>Weekend Rate ($)</th>
                                <th>Peak Season Rate ($)</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in room_types_data %}
                            <tr>
                                <td>
                                    <strong>{{ item.name }}</strong>
                                </td>
                                <td>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" step="0.01" min="0" class="form-control base-rate" 
                                               id="base_rate_{{ item.id }}" 
                                               name="base_rate_{{ item.id }}" 
                                               value="{{ item.base_rate|round(2) }}"
                                               data-room-id="{{ item.id }}">
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" step="0.01" min="0" class="form-control weekend-price" 
                                               id="weekend_price_{{ item.id }}" 
                                               name="weekend_price_{{ item.id }}" 
                                               value="{{ item.current_weekend_price|round(2) }}">
                                    </div>
                                </td>
                                <td>
                                    <div class="input-group">
                                        <span class="input-group-text">$</span>
                                        <input type="number" step="0.01" min="0" class="form-control peak-price" 
                                               id="peak_price_{{ item.id }}" 
                                               name="peak_price_{{ item.id }}" 
                                               value="{{ item.current_peak_price|round(2) }}">
                                    </div>
                                </td>
                                <td>
                                    <button type="button" class="btn btn-outline-secondary btn-sm calculate-btn" data-room-id="{{ item.id }}">
                                        <i class="fas fa-calculator me-1"></i> Calculate
                                    </button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                
                <div class="d-flex justify-content-end mt-3">
                    <button type="reset" class="btn btn-secondary me-2">
                        <i class="fas fa-undo me-2"></i> Reset
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i> Save Changes
                    </button>
                </div>
                {% else %}
                <div class="alert alert-info mb-0">
                    <p>No room types found. Please add room types first.</p>
                </div>
                {% endif %}
            </form>
        </div>
    </div>
    
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-info text-white">
                    <h3 class="h5 mb-0">Pricing Strategy</h3>
                </div>
                <div class="card-body">
                    <p>Room rates are structured as follows:</p>
                    <ul>
                        <li><strong>Base Rate:</strong> Standard weekday rate</li>
                        <li><strong>Weekend Rate:</strong> Typically 25% higher than base rate</li>
                        <li><strong>Peak Season Rate:</strong> Typically 50% higher than base rate</li>
                    </ul>
                    <p>Additional factors that may affect pricing:</p>
                    <ul>
                        <li>Special events (conferences, holidays)</li>
                        <li>Last-minute bookings</li>
                        <li>Extended stays</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header bg-success text-white">
                    <h3 class="h5 mb-0">Market Analysis</h3>
                </div>
                <div class="card-body">
                    <p class="mb-3">Competitive room rates in the area:</p>
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Hotel Class</th>
                                    <th>Average Rate ($)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Budget</td>
                                    <td>75 - 120</td>
                                </tr>
                                <tr>
                                    <td>Mid-range</td>
                                    <td>120 - 250</td>
                                </tr>
                                <tr>
                                    <td>Luxury</td>
                                    <td>250 - 500+</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <a href="{{ url_for('manager.dashboard') }}" class="btn btn-secondary mb-4">
        <i class="fas fa-arrow-left me-2"></i> Back to Dashboard
    </a>
</div>

<!-- Pricing Info Modal -->
<div class="modal fade" id="pricingInfoModal" tabindex="-1" aria-labelledby="pricingInfoModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="pricingInfoModalLabel">Room Pricing Guide</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <h5>Pricing Best Practices</h5>
                <p>Follow these guidelines when setting room rates:</p>
                
                <div class="row mb-3">
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">Base Rate</h6>
                                <p class="card-text">Standard weekday rate that reflects room amenities, size, and view.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">Weekend Rate</h6>
                                <p class="card-text">Set 20-30% higher than base rate to reflect higher demand on weekends.</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="card h-100">
                            <div class="card-body">
                                <h6 class="card-title">Peak Season Rate</h6>
                                <p class="card-text">Set 40-60% higher than base rate during high demand periods.</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <h5>Seasonal Considerations</h5>
                <p>Adjust rates based on the following seasonal patterns:</p>
                <ul>
                    <li><strong>High Season:</strong> Major holidays, summer months, local events</li>
                    <li><strong>Shoulder Season:</strong> Spring and fall months</li>
                    <li><strong>Low Season:</strong> Winter months (except holiday weeks)</li>
                </ul>
                
                <h5>Competitive Analysis</h5>
                <p>Always consider your competitive position in the market:</p>
                <ul>
                    <li>Research rates of similar properties in your area</li>
                    <li>Consider your property's unique selling points</li>
                    <li>Monitor occupancy rates to ensure pricing is optimal</li>
                </ul>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Helper function to calculate derived prices
        function calculateDerivedPrices(roomId) {
            const baseRateField = document.getElementById(`base_rate_${roomId}`);
            if (!baseRateField) return;

            const baseRate = parseFloat(baseRateField.value) || 0;
            const weekendPriceField = document.getElementById(`weekend_price_${roomId}`);
            const peakPriceField = document.getElementById(`peak_price_${roomId}`);
            
            // Calculate prices using standard multipliers
            const weekendPrice = (baseRate * 1.25).toFixed(2);
            const peakPrice = (baseRate * 1.5).toFixed(2);
            
            // Update fields
            if (weekendPriceField) weekendPriceField.value = weekendPrice;
            if (peakPriceField) peakPriceField.value = peakPrice;
        }
        
        // Add event listeners to calculate buttons
        const calculateButtons = document.querySelectorAll('.calculate-btn');
        calculateButtons.forEach(button => {
            button.addEventListener('click', function() {
                const roomId = this.dataset.roomId;
                calculateDerivedPrices(roomId);
            });
        });

        // Optional: Add event listeners to base rate fields to auto-calculate if desired
        const baseRateFields = document.querySelectorAll('.base-rate');
        baseRateFields.forEach(field => {
            field.addEventListener('change', function() {
                const roomId = this.dataset.roomId;
                calculateDerivedPrices(roomId);
            });
        });

        // Handle form reset to revert to original values or clear, depending on desired UX
        const pricingForm = document.getElementById('pricingForm');
        if (pricingForm) {
            const originalValues = {};
            // Store original values on load
            pricingForm.querySelectorAll('input[type="number"]').forEach(input => {
                originalValues[input.name] = input.value;
            });

            pricingForm.addEventListener('reset', function() {
                // Timeout to allow native reset to occur first
                setTimeout(() => {
                    for (const name in originalValues) {
                        const inputField = pricingForm.elements[name];
                        if (inputField) {
                            inputField.value = originalValues[name];
                        }
                    }
                }, 0);
            });
        }
    });
</script>
{% endblock %} 